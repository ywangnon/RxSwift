# ReplaySubject

## ğŸ” ReplaySubject â€” ê°’ Nê°œë¥¼ â€˜ë˜ê°ê¸°â€™í•˜ëŠ” ìºì‹œ Subject

> **í•µì‹¬ í‚¤ì›Œë“œ:** _Buffer Size_ Â· _Hot Stream_ Â· _Late Subscriber Catchâ€‘up_

`ReplaySubject<Element>`ëŠ” **ì§€ì •í•œ ë²„í¼ í¬ê¸°ë§Œí¼ ê³¼ê±° ê°’ì„ ì €ì¥**í•˜ì—¬, ìƒˆë¡œìš´ êµ¬ë…ìì—ê²Œ í•œêº¼ë²ˆì— ì¬ìƒ(Replay)í•©ë‹ˆë‹¤. ë™ì˜ìƒ í”Œë ˆì´ì–´ì˜ â€˜ë˜ê°ê¸°â€™ì²˜ëŸ¼ **ì´ì „ ì´ë²¤íŠ¸ ì»¨í…ìŠ¤íŠ¸**ê°€ ì¤‘ìš”í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

***

### 1ï¸âƒ£ íŠ¹ì§• í•œëˆˆì— ë³´ê¸°

| í•­ëª©      | ì„¤ëª…                                      |
| ------- | --------------------------------------- |
| ì´ˆê¸°ê°’     | âŒ (ì˜µì…˜)                                  |
| ë²„í¼ í¬ê¸°   | 1 \~ âˆ (`bufferSize:`)                  |
| êµ¬ë… ì‹œ ì „ë‹¬ | ë²„í¼ ë‚´ ëª¨ë“  ì´ë²¤íŠ¸ ì¬ìƒ í›„ ì‹¤ì‹œê°„ ìˆ˜ì‹                  |
| ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ  | `.onCompleted()` / `.onError()` í›„ ë²„í¼ í•´ì œ |

> ë²„í¼ í¬ê¸°ë¥¼ `Int.max`ë¡œ ì„¤ì •í•˜ë©´ **ì „ì²´ ê¸°ë¡**ì„ ì¬ìƒí•  ìˆ˜ ìˆìœ¼ë‚˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ì— ìœ ì˜í•˜ì„¸ìš”.

***

### 2ï¸âƒ£ ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ

```swift
// ìµœê·¼ 2ê°œ ê°’ ìºì‹œ
let subject = ReplaySubject<String>.create(bufferSize: 2)
let bag = DisposeBag()

subject.onNext("1ï¸âƒ£ One")
subject.onNext("2ï¸âƒ£ Two")
subject.onNext("3ï¸âƒ£ Three")

// êµ¬ë…ìëŠ” Two, Threeë¶€í„° ìˆ˜ì‹ 
subject
    .subscribe(onNext: { print($0) })
    .disposed(by: bag)

subject.onNext("4ï¸âƒ£ Four")
```

**ì¶œë ¥**

```
2ï¸âƒ£ Two
3ï¸âƒ£ Three
4ï¸âƒ£ Four
```

***

### 3ï¸âƒ£ ì‹¤ì „ íŒ¨í„´ â€” ì±„íŒ… ë©”ì‹œì§€ ìºì‹±

```swift
final class ChatRoomService {
    private let messageSubject = ReplaySubject<Message>.create(bufferSize: 50)
    private let bag = DisposeBag()

    // ì™¸ë¶€ ë…¸ì¶œ ìŠ¤íŠ¸ë¦¼
    var messages: Observable<[Message]> {
        messageSubject
            .scan([]) { acc, new in acc + [new] }
    }

    func receive(message: Message) {
        messageSubject.onNext(message)
    }
}

// ìƒˆë¡œ ë“¤ì–´ì˜¨ ì‚¬ìš©ìë„ ìµœê·¼ 50ê°œ ë©”ì‹œì§€ ì¦‰ì‹œ í‘œì‹œ ê°€ëŠ¥
```

***

### 4ï¸âƒ£ ë©”ëª¨ë¦¬ & í¼í¬ë¨¼ìŠ¤ ìµœì í™”

1. **ë²„í¼ í¬ê¸°**: ì‹¤ì œ UI/ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ ë²”ìœ„ë¡œ ì œí•œ â€” ë¬´ì œí•œ X.
2. **`windowTime:`**: ì‹œê°„ ê¸°ë°˜ ìºì‹±(`create(bufferSize:timeScheduler:)`)ë¡œ ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì œê±°.
3. **ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ ì²˜ë¦¬**: ë°© ë‚˜ê°€ê¸° ë“± í•„ìš” ì‹œ `.onCompleted()` í˜¸ì¶œí•´ ë²„í¼ í•´ì œ.

***

### 5ï¸âƒ£ Subject ê°„ ë¹„êµ ìš”ì•½

| Subject           | ìºì‹œ í¬ê¸°     | ì´ˆê¸°ê°’ | ì‚¬ìš© ì‚¬ë¡€                  |
| ----------------- | --------- | --- | ---------------------- |
| PublishSubject    | 0         | âŒ   | ë²„íŠ¼ íƒ­, ì•Œë¦¼               |
| BehaviorSubject   | 1         | âœ”ï¸  | í† ê¸€ ìƒíƒœ, Form Validation |
| **ReplaySubject** | n         | âŒ   | ì±„íŒ… íˆìŠ¤í† ë¦¬, ë¡œê·¸ ì¬ìƒ         |
| AsyncSubject      | 1 (ì™„ë£Œ ì‹œì ) | âŒ   | íŒŒì¼ ì—…ë¡œë“œ ê²°ê³¼, ë‹¨ì¼ ì‘ë‹µ       |

***

### 6ï¸âƒ£ Mini Quiz

1. ë²„í¼ í¬ê¸°ë¥¼ `3`ìœ¼ë¡œ ì„¤ì •í–ˆëŠ”ë° ì´ë²¤íŠ¸ë¥¼ 5ê°œ ë°œí–‰ í›„ ìƒˆë¡œ êµ¬ë…í•˜ë©´ ëª‡ ê°œë¥¼ ë°›ë‚˜ìš”?
2. `ReplaySubject`ì˜ ë²„í¼ê°€ ë©”ëª¨ë¦¬ë¥¼ ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ë‘ ê°€ì§€ ìµœì í™” ë°©ë²•ì€?
3. Combineì—ì„œ ë™ì¼í•œ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” SubjectëŠ”?

<details>

<summary>ì •ë‹µ</summary>

1. **3ê°œ** â€” ê°€ì¥ ìµœê·¼ 3ê°œ(ì´ë²¤íŠ¸ #3, #4, #5)ë¥¼ ì¬ìƒ í›„ ì´í›„ ì‹¤ì‹œê°„ ê°’ ìˆ˜ì‹ .
2. **ìµœì í™” ë°©ë²•**
   * ë²„í¼ í¬ê¸°ë¥¼ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ **ì‘ê²Œ ì„¤ì •** (`bufferSize`).
   * ì‹œê°„ ì œí•œ **`windowTime`** ì¸ìë¥¼ ì‚¬ìš©í•´ ì˜¤ë˜ëœ ì´ë²¤íŠ¸ë¥¼ ìë™ ì œê±°(`.create(bufferSize:timeInterval:scheduler:)`).
3. Combineì˜ **`ReplaySubject`**(Swift 5.10, CombineExt) ë˜ëŠ” ì„œë“œíŒŒí‹° _CombineExt_ íŒ¨í‚¤ì§€ì˜ `ReplaySubject`ê°€ ìœ ì‚¬ ë™ì‘ì„ ì œê³µí•©ë‹ˆë‹¤.

</details>

***

> ë‹¤ìŒ ë¬¸ì„œ â–¶ï¸ **AsyncSubject** ë¡œ ì´ë™í•´ ì™„ë£Œ ì‹œì  ë‹¨ì¼ ê°’ ì „ë‹¬ íŒ¨í„´ì„ ì•Œì•„ë´…ë‹ˆë‹¤. ğŸš€
